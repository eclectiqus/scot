<html><head><title>Controller::Api</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.35,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.022001 at Wed Sep  5 21:11:54 2018 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>
<div class='indexgroupEmpty'></div>

<dl>
<dt><a name="create"
><b>create</b></a></dt>

<dd>
<p>This function is called for POSTs to the API.
Data is passed in via Mojolicious&#39; handling of posted JSON and/or params.
See get_request_params for further info.</p>

<p>It expects a JSON blob that matches the description of the model we are attempting to create.
See Scot::Model::* for details.</p>

<p>This function returns the following JSON to the http client { id : the_integer_id_of_created_thing,
action : &#34;post&#34;,
thing : model_name_of_created_thing,
status : &#39;ok&#39;,
}</p>

<p>This function emits the following messages on the SCOT activemq topic:</p>

<pre>    {
        action : &#34;created&#34;,
        data   : {
            who     : &#34;user_name&#34;,
            type    : &#34;model_name_of_thing_created&#34;,
            id      : integer_id_of_thing_created
        }
    }</pre>

<p>This function writes the following record to the history collection { who =&#62; $user, what =&#62; &#34;created via api&#34;, when =&#62; $self-&#62;env-&#62;now, target =&#62; { id =&#62; $object-&#62;id, type =&#62; $colname, } }</p>

<p>additionaly, if the object is targetable, the target object will receive a similar history record.</p>

<p>This function creates the following record to the audit collection { who =&#62; $self-&#62;session(&#39;user&#39;) // &#39;unknown&#39;, when =&#62; $env-&#62;now(), what =&#62; $what, data =&#62; $data, }</p>

<dt><a name="list"
><b>list</b></a></dt>

<dd>
<p>This function is called for GETs to the API with out explicit ID provided.</p>

<p>It can have a JSON blob that specifies the &#34;filter&#34; to apply to the list as well as sorting, limit, and offset parameters. The user&#39;s group membership also determines if anything is display, e.g. unless the user has permission to read an object it will not appear in the list (change from 3.5.1)</p>

<p>This function returns the following JSON to the http client { records : [ { JSON object }, ... ], queryRecordCount : number_of_rec_in_records_array, totalRecordCount : number_of_matching_in_entire_db,</p>

<pre>    }</pre>

<p>This function does not emit any messages on the SCOT topic in activemq</p>

<p>This function does not write any records to the history collection</p>

<p>This function does not create any record to the audit collection</p>

<dt><a name="get_one"
><b>get_one</b></a></dt>

<dd>
<p>This function is called for GETs to the API with an id.</p>

<p>Special case: the id of &#34;maxid&#34; will return the maximum integer id for the collection.</p>

<p>Assuming the user has read permission for the object they will get: { object_JSON_representation }</p>

<p>This function does not emit any messages on the SCOT topic in activemq</p>

<p>This function does not write any records to the history collection but it will add a view record to the object itself.</p>

<p>This function creates the following record to the audit collection { who =&#62; $self-&#62;session(&#39;user&#39;) // &#39;unknown&#39;, when =&#62; $env-&#62;now(), what =&#62; $what, data =&#62; $request_href, }</p>

<p>This function creates a stat record for view count.</p>

<dt><a name="get_subthing"
><b>get_subthing</b></a></dt>

<dd>
<p>This function is called for GETs to the API for objects related to a given :thing :id, e.g. /scot/api/v2/alergroup/123/alert will return an array of alerts that are part of alertgroup 123.</p>

<p>It can have a JSON blob that specifies the &#34;filter&#34; to apply to the list as well as sorting, limit, and offset parameters. The user&#39;s group membership also determines if anything is display, e.g. unless the user has permission to read an object it will not appear in the list (change from 3.5.1)</p>

<p>This function returns the following JSON to the http client { records : [ { JSON object }, ... ], queryRecordCount : number_of_rec_in_records_array, totalRecordCount : number_of_matching_in_entire_db,</p>

<pre>    }</pre>

<p>This function does not emit any messages on the SCOT topic in activemq</p>

<p>This function does not write any records to the history collection</p>

<p>This function does not create any record to the audit collection</p>

<dt><a name="update"
><b>update</b></a></dt>

<dd>
<p>This function is called for POSTs to the API with an id.</p>

<p>Assuming the user has modify permission for the object they will get: { id : int_id_of_object_updated, status : &#34;ok&#34; }</p>

<p>This function emits messages on the SCOT topic in activemq { action : &#34;updated&#34;, data : { who : username, type : collection_name, id : id updated, what : [ things, that, were, done ] } } and messages for the target objects if updated object is targetable.</p>

<p>This function does write records to the history collection</p>

<p>This function creates the following record to the audit collection { who =&#62; $self-&#62;session(&#39;user&#39;) // &#39;unknown&#39;, when =&#62; $env-&#62;now(), what =&#62; $what, data =&#62; $request_href, }</p>

<p>This function creates a stat record for &#34;$collection updated&#34;</p>

<dt><a name="delete"
><b>delete</b></a></dt>

<dd>
<p>This function is called for DELETEs to the API. you can only delete by id.</p>

<p>This function returns the following JSON to the http client { id : the_integer_id_of_created_thing, action : &#34;delete&#34;, thing : model_name_of_created_thing, status : &#39;ok&#39;, }</p>

<p>This function emits the following messages on the SCOT activemq topic:</p>

<pre>    {
        action : &#34;deleted&#34;,
        data   : {
            who     : &#34;user_name&#34;,
            type    : &#34;model_name_of_thing_created&#34;,
            id      : integer_id_of_thing_created
        }
    }</pre>

<p>This function writes the following record to the history collection { who =&#62; $user, what =&#62; &#34;deleted via api&#34;, when =&#62; $self-&#62;env-&#62;now, target =&#62; { id =&#62; $object-&#62;id, type =&#62; $colname, } }</p>

<p>additionaly, if the object is targetable, the target object will receive a similar history record.</p>

<p>This function creates the following record to the audit collection { who =&#62; $self-&#62;session(&#39;user&#39;) // &#39;unknown&#39;, when =&#62; $env-&#62;now(), what =&#62; $what, data =&#62; $data, }</p>

<dt><a name="export"
><b>export</b></a></dt>

<dd>
<p>Create an exportable report /scot/api/v2/export/:thing/:id</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="POD_ERRORS"
>POD ERRORS</a></h1>

<p>Hey! <b>The above document had some coding errors, which are explained below:</b></p>

<dl>
<dt><a name="Around_line_17:"
>Around line 17:</a></dt>

<dd>
<p>&#39;=item&#39; outside of any &#39;=over&#39;</p>

<p>=over without closing =back</p>
</dd>
</dl>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
