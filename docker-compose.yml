version: '3'
services:
  apache:
    build:
      dockerfile: Dockerfile-Apache
      context: ./
    volumes: 
     - "/etc/timezone:/etc/timezone:ro"
     - "/etc/localtime:/etc/localtime:ro"
     - "/var/log/apache2:/var/log/apache2/"
    ports:
     - "443:443"
     - "80:80"
    networks:
     scot-docker-net:
      ipv4_address: 172.18.0.2
      aliases:
       - apache-docker
  activemq:
    volumes:
     - "/var/log/activemq:/var/log/activemq/log/"
#     - "/opt/activemq/webapps/scot:/opt/activemq/webapps/scot/"
    build:
      dockerfile: Dockerfile-Activemq
      context: ./
    #image: https://baltig.sandia.gov:4567/scot-activemq
    ports:
     - "8161:8161"
     - "61613:61613"
    networks:
     scot-docker-net:
      ipv4_address: 172.18.0.3
      aliases:
       - activemq-docker
  
  mongodb:
    build:
      dockerfile: Dockerfile-Mongodb
      context: ./
    volumes:
     - "/var/log/mongodb/mongod.log:/var/log/mongodb/mongod.log"
     - "/etc/timezone:/etc/timezone:ro"
     - "/etc/localtime:/etc/localtime:ro"
     - "/data/db:/data/db/"
    networks:
     scot-docker-net:
      ipv4_address: 172.18.0.4
      aliases:
       - mongodb-docker
    ports:
     - "27017:27017"
  
  elastic:
    healthcheck:
      test:  ["CMD", "curl", "--noproxy", "localhost",  "vvv","-u", "elastic:changeme", "http://localhost:9200/"]
      interval: 2s
      timeout: 5s
      retries: 30
    build:
      dockerfile: Dockerfile-Elastic
      context: ./
    volumes:
     - "/etc/timezone:/etc/timezone:ro"
     - "/etc/localtime:/etc/localtime:ro"
    networks:
     scot-docker-net:
      ipv4_address: 172.18.0.5
      aliases:
       - elastic-docker
    ports:
     - "9200:9200"

  mapping:
    build:
      dockerfile: Dockerfile-Mapping
      context: ./
    depends_on:
     - elastic
    networks:
     scot-docker-net:
      ipv4_address: 172.18.0.6
      aliases:
       - mapping-docker
  scot:
    build:
      dockerfile: Dockerfile-Scot
      context: ./
    volumes:
     - "/var/log/scot:/var/log/scot/"
     - "/etc/timezone:/etc/timezone:ro"
     - "/etc/localtime:/etc/localtime:ro"
    depends_on:
     - mongodb
     - activemq
    networks:
     scot-docker-net:
      ipv4_address: 172.18.0.7
      aliases:
       - scot-docker
    ports:
     - "3000:3000"

  flair:
   build:
     dockerfile: Dockerfile-Flair
     context: ./
   volumes:
    - "/var/log/scot:/var/log/scot/"
   depends_on:
    - mongodb
    - activemq
    - scot
   networks:
     scot-docker-net:
      ipv4_address: 172.18.0.8
      aliases:
       - flair-docker
  stretch:
   build:
     dockerfile: Dockerfile-Stretch
     context: ./
   volumes:
    - "/var/log/scot:/var/log/scot/"
   depends_on:
    - mongodb
    - activemq
    - scot
   networks:
     scot-docker-net:
      ipv4_address: 172.18.0.9
      aliases:
       - stretch-docker

networks:
  scot-docker-net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.18.0.0/16
